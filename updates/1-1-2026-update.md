# Update Log - January 1, 2026

## Bot Fixes

### Critical Bug Fixes
- **Fixed syntax error in main.js**: Corrected malformed catch block that prevented bot startup
- **Fixed syntax errors in embed-loader.js**: Cleaned up incomplete refactoring code that caused crashes
- **Fixed URL handling**: Ensured verification URLs always end with `/oauth2/` for proper redirects

### Placeholder System
- **Improved pullback_results embed**: Now properly replaces `{success}`, `{failed}`, and `{already_in}` placeholders in both description and field values
- Eliminates duplicate fields with hardcoded emojis

### Configuration Management
- **Centralized URL configuration**: Moved all hardcoded URLs to `config.xml`
  - Added `<web_url>` for frontend URL
  - Added `<api_base_url>` for backend API URL
  - All components now read URLs from config instead of hardcoded values
- **Updated files**: main.js, config-loader.js, embed-loader.js, api.js, auth.js, verify-embed.js
- **Made all config values required**: Bot now throws clear errors if web_url or api_base_url are missing

### Code Cleanup
- **Removed unused SQL embeds**: Deleted error, success, info, warning from database migration (bot uses fallback methods)
- **Removed unused methods from embeds.js**: 
  - `authLink()` - bot uses database version
  - `verifiedUsersList()` - bot uses database version  
  - `pullbackResults()` - bot uses database version
  - `warning()` - never used
- **Final embed count**: 4 database embeds (verification, auth_link, verified_users_list, pullback_results) + 4 fallback methods (error, success, info, verification)

---

## Admin Panel Improvements

### UI Enhancements
- **Removed "New Embed" button**: Embeds are pre-defined and managed through editing only
- **Removed embed delete buttons**: Prevents accidental deletion of required embeds
- **Added version display**: Shows Panel Version (1.0.0) and Cache Version above logout button

### Emoji Management
- **Custom confirmation dialogs**: Replaced browser alerts with styled modals for edit and delete actions
  - Edit: Accent border with confirmation before opening editor
  - Delete: Red border with warning message for destructive action
- **Enhanced modal styling**: Added bright accent border (`border-2 border-accent`) to Add/Edit Emoji modal for better visibility

### Embed Editor Improvements
- **Removed emoji pickers from unsupported fields**:
  - Author name (Discord doesn't support custom emojis)
  - Footer text (Discord doesn't support custom emojis)
- **Added helper notes**: Explains why emoji pickers are disabled on these fields
- **Kept emoji pickers on**: Title, Description, Field names/values (fully supported)

### Cache Management
- **Updated cache version**: v53 → v55 across all dashboard pages
- **Applied to**: embeds, emojis, dashboard, users, settings, sync, pullback, permissions pages
- Ensures browsers load updated JavaScript files

---

## Documentation Updates

### Discord Bot Installation Guide
- **Enhanced config.xml documentation**:
  - `API_SECRET`: Shared secret across all components
  - `WEB_URL`: Frontend URL for verification redirects (e.g., `https://example.com`)
  - `API_BASE_URL`: Backend API endpoint (e.g., `https://api.example.com/v2/oauth2/discord`)
- All configuration values now have clear descriptions and example formats

---

## Repository Changes

### .gitignore Updates
- **Properly excluded broken files**:
  - `/installers/` - Incomplete installation scripts
  - `install.sh` - Broken installation script
- Changed from `/installers` to `/installers/` for proper directory exclusion

---

## Database Migration

### Embeds Table
**Migration command:**
```sql
DROP TABLE IF EXISTS embeds;
SOURCE /path/to/database/migrations/13-12-2025-embeds.sql;
```

**Changes:**
- Removed 4 unused embed templates (error, success, info, warning)
- Kept only the 4 embeds actively used by bot commands
- Table now contains: verification, auth_link, verified_users_list, pullback_results

---

## Breaking Changes

⚠️ **Required Actions:**

1. **Update config.xml**: Add `<web_url>` and `<api_base_url>` tags
   ```xml
   <config>
     <api_secret>your_secret_here</api_secret>
     <web_url>https://your-domain.com</web_url>
     <api_base_url>https://api.your-domain.com/v2/oauth2/discord</api_base_url>
   </config>
   ```

2. **Migrate database**: Run the embeds migration to remove unused templates

3. **Clear browser cache**: Force refresh (Ctrl+F5) on admin panel to load v54 scripts

---

## Files Modified

### Guides
- `guides/backend-install.md` - Extended the guide

### Bot
- `bot/main.js` - Fixed syntax error, uses config URLs
- `bot/config-loader.js` - Loads web_url and api_base_url from XML
- `bot/embed-loader.js` - Fixed syntax errors, uses config.api_base
- `bot/embeds.js` - Removed 4 unused methods
- `bot/config.xml` - Added web_url and api_base_url
- `bot/commands/api.js` - Uses config.api_base_url, improved placeholder replacement
- `bot/commands/auth.js` - Uses config.web_url
- `bot/commands/verify-embed.js` - Uses config.web_url with trailing slash fix

### Admin Panel
- `webroot/admin/components/sidebar.js` - Added version display, v53→v54
- `webroot/admin/js/embeds.js` - Removed delete button from list
- `webroot/admin/js/emojis.js` - Added custom confirmation modals
- `webroot/admin/dashboard/embeds/index.html` - Removed emoji pickers from author/footer, removed "New Embed" button, v54
- `webroot/admin/dashboard/emojis/index.html` - Enhanced modal border, v54
- All dashboard HTML files - Updated to sidebar v54

### Database
- `database/migrations/13-12-2025-embeds.sql` - Removed unused embed inserts

### Documentation
- `guides/discord-bot-install.md` - Added WEB_URL and API_BASE_URL descriptions
- `.gitignore` - Fixed installers/ and install.sh exclusion

---

## Statistics

- **Files Modified**: 21
- **Lines Changed**: ~300+
- **Bugs Fixed**: 3 critical, multiple minor
- **Features Added**: Version display, confirmation modals, centralized config
- **Code Removed**: 4 SQL embeds, 4 JS methods, hardcoded URLs
- **Cache Version**: v54
- **Panel Version**: 1.0.0

## News

Happy 2026 to every person reading this